<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <title>Onim - Curtiu?</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
    <link rel="stylesheet" href="css.css">
       
    </head>
  <body>
    
    <!-- get 1 acess // descontinous
    has-background-danger
    -->
    <div class="modal boxMessage">
      <div class="modal-background"></div>
      <div class="modal-content boxMessageParent"> 
        <div class="media boxMessageContent glowWhite">
          <div class="media-left">
            <figure class="image is-48x48 loadImage">
              <img  class="boxMessageImage has-background-white" loading="lazy">
            </figure>
          </div>
          <div class="media-content">
            <p class="title is-4 boxMessageTitulo">  </p>
            <p class="subtitle is-6 mt-2 boxMessageSubtitulo has-text-weight-semibold"> </p> 
            <button class="button is-danger is-light boxMessageBtFecha">❌ Fechar </button>           
          </div>
                             
        </div>         
      </div>
      <button class="modal-close is-large" aria-label="close"></button>
    </div>
    
    <main class="containerApp" >                                  
           
      <section class="bodyView">
                
          <!-- <div class="inverted-border-radius">  </div> -->
          
          <!-- get Persist Area -->
          <div class="is-flex is-align-items-center is-flex-direction-column is-justify-content-space-around h-100-per ">          
            
            <!-- get GPS Area-->
            <div class="areaGPS  w-90-per  has-text-centered h-100-per"> 
              
              <div class="box  areaGPSText h-100-per ">                 
                         
                <div class="">
                  <figure class="image imp-25-per centerMe">
                    <img  class="" loading="lazy" data-src="marca.png" data-alt="Marca" class="">
                  </figure>
                </div>

                <p class="subtitle m-5 has-background-warning">
                  <span class="icon is-small">
                    <i class="fas fa-clipboard-check"></i>
                  </span>
                  Pesquisa de satisfação
                </p>

                <form id="formFeedback">                  
                  
                  <p class="mt-5"> Curtiu? </p>
                  

                  <div class="field">                    
                    <div class="radios is-flex is-flex is-flex-wrap-wrap is-justify-content-space-evenly">
                      <label class="radio m-2 button " onclick="selectButton(this, 'curtiu')">
                        <span class="icon is-small">
                          <i class="fas fa-thumbs-up"></i>
                        </span>
                        <input type="radio" name="curtiu" id="curtiuSim" value="1" required  class="is-checkradio is-hidden"/>
                        Sim
                      </label>
                      <label class="radio m-2 button " onclick="selectButton(this, 'curtiu')" >
                        <span class="icon is-small">
                          <i class="fas fa-thumbs-down"></i>
                        </span>
                        <input type="radio" name="curtiu" id="curtiuNão" value="3" class="is-checkradio is-hidden"/>
                        Não
                      </label>
                      <label class="radio m-2 button " onclick="selectButton(this, 'curtiu')">
                        <span class="icon is-small">
                          <i class="fas fa-thumbs-up"></i>
                        </span>
                        <span class="icon is-small">
                          <i class="fas fa-thumbs-down"></i>
                        </span>
                        <input type="radio" name="curtiu" id="curtiuMaisoumenos" value="2" class="is-checkradio is-hidden"/>
                        Mais ou menos
                      </label>

                    </div>                    
                  </div>

                  <p class="mt-5 "> Devido a... </p>                  
                  <div class="field ">  
                    <div class="checkboxes is-flex is-flex-wrap-wrap is-justify-content-space-evenly">
                      <label class="checkbox m-2 button " onclick="selectButton(this, 'devido',1)">
                        <input type="checkbox" value="sabor" name="devido" id="DevidoSabor" class="is-checkradio is-hidden" required />
                        Sabor 
                      </label>                                      
                    
                      <label class="checkbox m-2 button " onclick="selectButton(this, 'devido',1)">
                        <input type="checkbox" value="quantidade" name="devido" id="DevidoQuantidade" class="is-checkradio is-hidden"/>
                        Quantidade
                      </label>
                    
                      <label class="checkbox m-2 button " onclick="selectButton(this, 'devido',1)">
                        <input type="checkbox" value="embalagem" name="devido" id="DevidoEmbalagem" class="is-checkradio is-hidden"/>
                        Embalagem
                      </label>
                    
                      <label class="checkbox m-2 button " onclick="selectButton(this, 'devido',1)">
                        <input type="checkbox" value="atendimento" name="devido" id="DevidoAtendimento" class="is-checkradio is-hidden"/>
                        Atendimento
                      </label>

                      <label class="checkbox m-2 button " onclick="selectButton(this, 'devido',1)">
                        <input type="checkbox" value="qualidade" name="devido" id="DevidoQualidade" class="is-checkradio is-hidden"/>
                        Qualidade
                      </label>
                    
                      <label class="checkbox m-2 button " onclick="selectButton(this, 'devido',1)">
                        <input type="checkbox" value="outros" name="devido" id="DevidoOutros" class="is-checkradio is-hidden"/>
                        Outros
                      </label>
                    </div>                  
                  </div>
                  
                  <div class="field mt-5">  
                    <textarea
                    class="textarea is-link"
                    placeholder="Comentários?"
                    name="comentario"
                    id="comentario"
                  ></textarea>
                  </div>
                  
                  <div class="field mt-6">                    
                    <p class="control">
                      <button id="enviarFeedback" class="button backCor1">
                        <span class="icon"><i class="fas fa-paper-plane"> </i></span>
                        <strong> Enviar! </strong>
                      </button>
                    </p>                    
                  </div>

                </form>
              
              </div>  

            </div>
       
      </section>       
   
    </main>

    <script>

      function selectButton(label, groupName, radio=0) {
        
        if(!radio){
          const buttons = document.querySelectorAll(`input[name="${groupName}"]`);
          buttons.forEach(button => button.parentElement.classList.remove('is-selected'));
          label.classList.add('is-selected')          
        }else{
          label.classList.toggle('is-selected')
        }                           
      }
      
      document.querySelectorAll(`input[name="devido"]`).forEach(el => el.addEventListener('click',(event) => event.stopPropagation() ))
      
      document.getElementById('enviarFeedback').addEventListener('click', function(event) {
        event.preventDefault(); // Prevent the default form submission

        const form = document.getElementById('formFeedback'); // Reference to the form
        const radioButtons = form.querySelectorAll('input[name="curtiu"]');
        const checkboxes = form.querySelectorAll('input[name="devido"]:checked');
        const textarea = form.querySelector('textarea[name="comentario"]');

        let isRadioChecked = Array.from(radioButtons).some(radio => radio.checked);
        let isCheckboxChecked = checkboxes.length > 0;

        // Validate the form
        if (!isRadioChecked) {
            alert('Selecione uma opção em "Curtiu?"');
            return; // Exit the function if validation fails
        }

        if (!isCheckboxChecked) {
            alert('Selecione ao menos uma opção em  "Devido a..."');
            return; // Exit the function if validation fails
        }

        // Build the query string
        const formData = new FormData(form);
        const queryString = new URLSearchParams(formData).toString();

        // You can log the query string to see the result
        console.log('Query string:', queryString);

        fetch(`https://detailed-mercurial-duckling.glitch.me/salvaOnimFeeback/?${queryString}`, {
            method: 'GET'
        })
        .then(response => response.json()) // Assuming the server responds with JSON
        .then(data => {         
          
          document.getElementById('formFeedback').innerHTML = `
            <article class="message is-primary">
              <div class="message-header">
                <p>Tudo certo!</p>
                <!--<button class="delete" aria-label="delete"></button> -->
              </div>
              <div class="message-body">
                <span class="icon"><i class="fas fa-hourglass-end"> </i></span> Suas impressões foram enviadas! <br/>
                Obrigado por esse tempinho dispensado.
              </div>
            </article>
          `
          window.scrollTo({
              top: 0,
              left: 0,
              behavior: 'smooth' // This makes the scrolling smooth
          });
          console.log('Success:', data);                      
        })
        .catch((error) => {
          document.getElementById('formFeedback').innerHTML = `
            <article class="message is-danger">
              <div class="message-header">
                <p>Eta...!</p>
                <!--<button class="delete" aria-label="delete"></button> -->
              </div>
              <div class="message-body">
                 <span class="icon"><i class="fas fa-face-sad-tear"> </i></span> Infelizmente suas impressões não puderam ser enviadas. <br/>
                  Poderia atualizar a página e tentar novamente? <br/>
                  Agradecemos :)
              </div>
            </article>
          `    
          console.error('Error:', error);
        });
      });

      imagesToLoad = document.querySelectorAll("img[data-src]")
      auxLoadImages = (image) => {    
        image.setAttribute("src", image.getAttribute("data-src"));
        image.setAttribute("alt", image.getAttribute("data-alt"));
        image.onload = () => {
            image.removeAttribute("data-src");
        };
      };

      if(imagesToLoad.length > 0) for(i=0;i < imagesToLoad.length;i++) auxLoadImages(imagesToLoad[i]);
      

    </script>
    
  </body>
</html>